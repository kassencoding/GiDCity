<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Aitax SuperApp</title> 
    <link rel="stylesheet" href="style.css">
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>

    <div id="background-layer"></div>
    <div class="cyber-grid"></div>

    <div id="auth-screen" class="auth-overlay">
        <div class="auth-card">
            <h1>Aitax ID</h1>
            <p>–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤—Å–µ–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏</p>
            <div class="input-group-auth">
                <input type="text" placeholder="–í–∞—à–µ –ò–º—è" id="auth-name" class="glass-inp">
                <input type="tel" value="+7 " id="auth-phone" class="glass-inp" oninput="checkPhoneInput()">
                <div class="sms-group" style="display:none; margin-top:10px;" id="sms-block">
                    <input type="number" placeholder="–ö–æ–¥ –∏–∑ –°–ú–°" id="auth-code" class="glass-inp" value="1234">
                    <small style="color:gray; display:block; margin-top:5px;">–ö–æ–¥: 1234</small>
                </div>
            </div>
            <button class="btn-full" onclick="tryLogin()" id="btn-login-action">–í–æ–π—Ç–∏</button>
            <div class="guest-link" onclick="continueAsGuest()">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∫–∞–∫ –≥–æ—Å—Ç—å (–¢–æ–ª—å–∫–æ –ª–µ–Ω—Ç–∞)</div>
        </div>
    </div>

    <div class="top-bar">
        <div class="status-row">
            <span>Karaganda</span> ‚Ä¢ <span>-2¬∞C ‚ùÑÔ∏è</span>
            <ion-icon name="chevron-down-outline"></ion-icon>
        </div>
        <div class="brand-row">
            <div class="logo">Aitax</div>
            <div class="btn-icon" onclick="toggleSidebar()"><ion-icon name="grid-outline"></ion-icon></div>
        </div>
    </div>

    <div class="sidebar" id="sidebar">
        <div id="sidebar-main">
            <div class="m-head">
                <h3>–ú–µ–Ω—é</h3>
                <button class="close-m" onclick="toggleSidebar()"><ion-icon name="close"></ion-icon></button>
            </div>
            
            <div class="profile-card-large">
                <div class="avatar-upload">
                    <div class="current-avatar" id="sidebar-avatar"><ion-icon name="person"></ion-icon></div>
                    <label for="avatar-input" class="edit-icon"><ion-icon name="camera"></ion-icon></label>
                    <input type="file" id="avatar-input" hidden accept="image/*">
                </div>
                <div class="profile-info">
                    <div class="p-name" id="profile-name">–ì–æ—Å—Ç—å</div>
                    <div class="p-phone" id="profile-phone">+7 ...</div>
                </div>
            </div>

            <div class="divider"></div>

            <div class="settings-grid">
                <div class="setting-card" onclick="openSubMenu('language')">
                    <div class="s-icon-box" style="color:#a29bfe; background:rgba(162,155,254,0.15);"><ion-icon name="language"></ion-icon></div>
                    <span>–Ø–∑—ã–∫</span>
                </div>
                <div class="setting-card" onclick="openSubMenu('theme')">
                    <div class="s-icon-box" style="color:#fd79a8; background:rgba(253,121,168,0.15);"><ion-icon name="color-palette"></ion-icon></div>
                    <span>–¢–µ–º–∞</span>
                </div>
                <div class="setting-card" onclick="alert('–î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∫–ª–∞–º—É')">
                    <div class="s-icon-box" style="color:#ff7675; background:rgba(255,118,117,0.15);"><ion-icon name="megaphone"></ion-icon></div>
                    <span>–†–µ–∫–ª–∞–º–∞</span>
                </div>
                 <div class="setting-card" onclick="alert('–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤')">
                    <div class="s-icon-box" style="color:#00cec9; background:rgba(0,206,201,0.15);"><ion-icon name="time"></ion-icon></div>
                    <span>–ò—Å—Ç–æ—Ä–∏—è</span>
                </div>
            </div>
        </div>

        <div id="sidebar-language" class="sidebar-sub" style="display:none;">
            <div class="m-head">
                <button class="back-btn" onclick="closeSubMenu()"><ion-icon name="arrow-back"></ion-icon></button>
                <h3>–Ø–∑—ã–∫</h3>
            </div>
            <button class="setting-list-btn active">–†—É—Å—Å–∫–∏–π üá∑üá∫</button>
            <button class="setting-list-btn">“ö–∞–∑–∞“õ—à–∞ üá∞üáø</button>
            <button class="setting-list-btn">English üá∫üá∏</button>
        </div>

        <div id="sidebar-theme" class="sidebar-sub" style="display:none;">
            <div class="m-head">
                <button class="back-btn" onclick="closeSubMenu()"><ion-icon name="arrow-back"></ion-icon></button>
                <h3>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ</h3>
            </div>
            <div class="theme-grid">
                <div class="theme-circle" style="background: linear-gradient(135deg, #0f0c29, #302b63);"></div>
                <div class="theme-circle" style="background: linear-gradient(135deg, #16222A, #3A6073);"></div>
                <div class="theme-circle" style="background: linear-gradient(135deg, #191919, #620808);"></div>
                <div class="theme-circle" style="background: linear-gradient(135deg, #000000, #434343);"></div>
            </div>
        </div>
    </div>

    <div id="city-view" class="view custom-scroll">
        <div class="city-tabs-header">
            <button class="c-tab active" onclick="switchCityTab('billboard')">–ê—Ñ–∏—à–∞</button>
            <button class="c-tab" onclick="switchCityTab('map')">–ö–∞—Ä—Ç–∞</button>
        </div>

        <div id="tab-billboard" class="city-content active">
            <div class="ad-feed">
                <div class="ad-card premium">
                    <div class="ad-badge">Promoted</div>
                    <img src="https://placehold.co/600x300/1a1a1a/FFF?text=Concert+Show" class="ad-img">
                    <div class="ad-info">
                        <h3>–ì—Ä–∞–Ω–¥–∏–æ–∑–Ω—ã–π –∫–æ–Ω—Ü–µ—Ä—Ç</h3>
                        <p>–°–∫–∏–¥–∫–∏ 50% –Ω–∞ –±–∏–ª–µ—Ç—ã —Ç–æ–ª—å–∫–æ —Å–µ–≥–æ–¥–Ω—è!</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="tab-citymap" class="city-content">
            <div id="city-map-container"></div>
             <div class="map-overlays" style="bottom: 100px;">
                <div class="map-btn-locate" onclick="centerCityMap()"><ion-icon name="locate"></ion-icon></div>
            </div>
        </div>
    </div>

    <div id="home-view" class="view home-view active">
        <div id="map-container"></div>
        
        <div class="map-overlays">
            <div class="map-btn-locate restore-panel-btn" onclick="togglePanel()" style="display:none;">
                <ion-icon name="chevron-up"></ion-icon>
            </div>
            <div class="map-btn-locate" onclick="centerMap()"><ion-icon name="locate"></ion-icon></div>
        </div>

        <div class="chat-container"></div>

        <div class="order-panel" id="main-panel">
            <div class="panel-handle" onclick="togglePanel()"></div>

            <div class="chat-input-row">
                <div class="input-wrapper improved">
                    <input type="text" placeholder="AI —á–∞—Ç (–ö—É–¥–∞ –µ–¥–µ–º?)" id="chatInput">
                    <button class="btn-send-inside" onclick="sendMessage()">
                        <ion-icon name="arrow-up"></ion-icon>
                    </button>
                </div>
            </div>

            <div class="address-block">
                <div class="input-line">
                    <ion-icon name="navigate" style="color:var(--accent)"></ion-icon>
                    <div class="addr-text">
                        <div class="lbl">–û—Ç–∫—É–¥–∞</div>
                        <div class="val">–ú–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</div>
                    </div>
                </div>
                <div class="divider-h"></div>
                <div class="input-line">
                    <ion-icon name="location" style="color:#ff4757"></ion-icon>
                    <div class="addr-text">
                        <div class="lbl">–ö—É–¥–∞</div>
                        <input type="text" class="clean-addr-inp" placeholder="–£–∫–∞–∂–∏—Ç–µ —Ç–æ—á–∫—É –ë">
                    </div>
                </div>
            </div>

            <div class="options-row">
                <div class="opt-box" onclick="openModal('comment-modal')">
                    <div class="lbl">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</div>
                    <div>–£–∫–∞–∑–∞—Ç—å...</div>
                </div>
                <div class="opt-box">
                    <div class="lbl">–í—Ä–µ–º—è</div>
                    <div>–°–µ–π—á–∞—Å</div>
                </div>
            </div>

            <div class="tariffs-row custom-scroll-x">
                <div class="tariff selected" onclick="selectTariff(this)">–≠–∫–æ–Ω–æ–º</div>
                <div class="tariff" onclick="selectTariff(this)">–ö–æ–º—Ñ–æ—Ä—Ç</div>
                <div class="tariff" onclick="selectTariff(this)">–ë–∏–∑–Ω–µ—Å</div>
                <div class="tariff pink-taxi" onclick="selectTariff(this)" style="color:#ff69b4; border-color:#ff69b4;">Lady üå∏</div>
            </div>

            <button class="btn-go" onclick="startOrder()">–ü–æ–µ—Ö–∞–ª–∏</button>
        </div>
    </div>

    <div id="feed-view" class="view custom-scroll">
        <div class="feed-header">
            <select class="city-select glass-inp" style="width: auto; padding: 8px;">
                <option>–í—Å–µ –≥–æ—Ä–æ–¥–∞</option>
                <option selected>–ö–∞—Ä–∞–≥–∞–Ω–¥–∞</option>
                <option>–ê—Å—Ç–∞–Ω–∞</option>
                <option>–ê–ª–º–∞—Ç—ã</option>
            </select>
        </div>

        <div class="feed-composer">
            <div class="composer-top">
                <div class="avatar-circle"><ion-icon name="person"></ion-icon></div>
                <div class="composer-placeholder" onclick="openModal('create-post-modal')">–ß—Ç–æ –Ω–æ–≤–æ–≥–æ?</div>
            </div>
        </div>
        
        <div class="feed-stream" id="feed-container">
            <div class="post-card" id="post-1">
                <div class="post-head">
                    <div class="avatar-circle">A</div>
                    <div style="flex:1; margin-left:10px;">
                        <div class="name-row">
                            <span class="name">Admin</span>
                            <span class="verified"><ion-icon name="checkmark-circle"></ion-icon></span>
                        </div>
                        <div class="time">2—á</div>
                    </div>
                    <button class="trash-btn" onclick="deletePost('post-1')"><ion-icon name="trash-outline"></ion-icon></button>
                </div>
                <div class="post-content">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Aitax! üöÄ</div>
                <div class="post-actions-bar">
                    <button class="act-btn" onclick="toggleLike(this)"><ion-icon name="heart-outline"></ion-icon> <span>12</span></button>
                    <button class="act-btn" onclick="openCommentModal('post-1')"><ion-icon name="chatbubble-outline"></ion-icon></button>
                    <button class="act-btn"><ion-icon name="paper-plane-outline"></ion-icon></button>
                </div>
            </div>
        </div>
    </div>

    <div id="wallet-view" class="view custom-scroll">
        <div class="wallet-card">
            <div style="color:rgba(255,255,255,0.7); font-size:13px;">–ë–∞–ª–∞–Ω—Å</div>
            <div class="w-amount">42 500 ‚Ç∏</div>
            
            <div class="w-actions">
                <button onclick="openWalletModal('deposit')">
                    <div class="icon-circle"><ion-icon name="add"></ion-icon></div>
                    <span>–ü–æ–ø–æ–ª–Ω–∏—Ç—å</span>
                </button>
                <button onclick="openWalletModal('transfer')">
                    <div class="icon-circle"><ion-icon name="arrow-forward"></ion-icon></div>
                    <span>–ü–µ—Ä–µ–≤–µ—Å—Ç–∏</span>
                </button>
                <button onclick="openWalletModal('qr')">
                    <div class="icon-circle"><ion-icon name="qr-code"></ion-icon></div>
                    <span>QR</span>
                </button>
            </div>
             <div class="bonus-note">‚ö°Ô∏è –ü–æ–ø–æ–ª–Ω—è–π—Ç–µ —Å—á–µ—Ç –∏ –∫–∞—Ç–∞–π—Ç–µ—Å—å —Å–æ —Å–∫–∏–¥–∫–æ–π!</div>
        </div>

        <div class="section-title">–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</div>
        <div class="history-list">
             <div class="card-item">
                <div class="icon-box red"><ion-icon name="car"></ion-icon></div>
                <div class="card-data">
                    <div>–ü–æ–µ–∑–¥–∫–∞</div>
                    <small>–°–µ–≥–æ–¥–Ω—è</small>
                </div>
                <div class="card-sum red">-800 ‚Ç∏</div>
            </div>
        </div>
    </div>

    <div id="driver-view" class="view custom-scroll">
        <div class="driver-block">
            <div class="driver-avatar-icon" id="driver-avatar-display"><ion-icon name="person"></ion-icon></div>
            <div class="driver-name" id="driver-name-display">–ò–º—è –§–∞–º–∏–ª–∏—è</div>
            <div class="car-details">Toyota Camry ‚Ä¢ 777 AAA 01</div>
        </div>
        <div class="section-title">–≠—Ñ–∏—Ä –∑–∞–∫–∞–∑–æ–≤</div>
        <div class="orders-list">
            <div class="order-strip">
                <div class="route-info">
                    <div style="font-weight:700;">–¶–µ–Ω—Ç—Ä ‚Üí –Æ–≥–æ-–í–æ—Å—Ç–æ–∫</div>
                    <div style="font-size:12px; color:gray; margin-top:4px;">–≠–∫–æ–Ω–æ–º ‚Ä¢ 5.2 –∫–º</div>
                </div>
                <div style="text-align:right;">
                    <div class="price-tag">2000 ‚Ç∏</div>
                    <button class="take-btn-big" onclick="openOrderNegotiation(1)">–í–∑—è—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay hidden" id="comment-modal">
        <div class="modal-card">
            <div class="m-head">
                <h3>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</h3>
                <button class="close-m" onclick="closeModal('comment-modal')"><ion-icon name="close"></ion-icon></button>
            </div>
            <div class="input-group-modal">
                <input type="text" class="modal-inp glass-inp" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: —Å —Ä–µ–±–µ–Ω–∫–æ–º...">
            </div>
            <button class="btn-full" onclick="closeModal('comment-modal')">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>

    <div class="modal-overlay hidden" id="create-post-modal">
        <div class="modal-card">
            <div class="m-head">
                <h3>–ù–æ–≤—ã–π –ø–æ—Å—Ç</h3>
                <button class="close-m" onclick="closeModal('create-post-modal')"><ion-icon name="close"></ion-icon></button>
            </div>
            <textarea class="modal-textarea glass-inp" id="new-post-text" placeholder="–¢–µ–∫—Å—Ç –ø–æ—Å—Ç–∞..."></textarea>
            <div style="margin: 10px 0;">
                <button class="btn-icon-small"><ion-icon name="image-outline"></ion-icon> –§–æ—Ç–æ</button>
            </div>
            <div class="offer-actions">
                <button class="btn-outline" onclick="closeModal('create-post-modal')">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn-full" onclick="publishPost()">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay hidden" id="comment-thread-modal">
        <div class="modal-card">
            <div class="m-head">
                <h3>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</h3>
                <button class="close-m" onclick="closeModal('comment-thread-modal')"><ion-icon name="close"></ion-icon></button>
            </div>
            <input type="text" class="modal-inp glass-inp" placeholder="–í–∞—à –æ—Ç–≤–µ—Ç...">
            <button class="btn-full" onclick="closeModal('comment-thread-modal')">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>
    </div>

    <div class="modal-overlay hidden" id="order-negotiation-modal">
        <div class="modal-card">
            <div class="m-head">
                <h3>–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</h3>
                <button class="close-m" onclick="closeModal('order-negotiation-modal')"><ion-icon name="close"></ion-icon></button>
            </div>
            <div class="offer-price-display">2000 ‚Ç∏</div>
            <div class="offer-actions">
                <button class="btn-outline" onclick="offerMyPrice()">–°–≤–æ—è —Ü–µ–Ω–∞</button>
                <button class="btn-full" onclick="sendDriverOffer()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay hidden" id="client-decision-modal">
        <div class="modal-card">
            <div class="m-head"><h3>–í–æ–¥–∏—Ç–µ–ª—å –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç</h3></div>
            <div class="offer-price-display" id="client-offer-price">2000 ‚Ç∏</div>
            <div class="offer-actions">
                <button class="btn-outline" style="border-color:red; color:red;" onclick="closeModal('client-decision-modal')">–û—Ç–∫–∞–∑–∞—Ç—å</button>
                <button class="btn-full" style="background:var(--success-green);" onclick="clientAccept()">–ü—Ä–∏–Ω—è—Ç—å</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay hidden" id="wallet-action-modal">
        <div class="modal-card">
            <div class="m-head">
                <h3 id="wallet-modal-title">–û–ø–µ—Ä–∞—Ü–∏—è</h3>
                <button class="close-m" onclick="closeModal('wallet-action-modal')"><ion-icon name="close"></ion-icon></button>
            </div>
            <div class="qr-placeholder" id="qr-view" style="display:none; text-align:center;">
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=AitaxPayment" style="border-radius:10px;">
                <p style="margin-top:10px;">–°–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR</p>
            </div>
            <div id="wallet-inputs">
                <input type="number" class="modal-inp glass-inp" placeholder="–°—É–º–º–∞ (‚Ç∏)" style="margin-bottom:15px;">
                <button class="btn-full">–í—ã–ø–æ–ª–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <div class="dock-bar">
        <button class="dock-item" onclick="switchTab('city')"><ion-icon name="map-outline"></ion-icon></button>
        <button class="dock-item" onclick="switchTab('feed')"><ion-icon name="people-outline"></ion-icon></button>
        <div class="ai-button-wrapper">
            <div class="ai-button" onclick="switchTab('home')">Ai</div>
        </div>
        <button class="dock-item" onclick="switchTab('wallet')"><ion-icon name="wallet-outline"></ion-icon></button>
        <button class="dock-item" onclick="switchTab('driver')"><ion-icon name="car-sport-outline"></ion-icon></button>
    </div>

    <script src="script.js"></script>
</body>
</html>
