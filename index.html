<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Aitax Mini App</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="style (3).css">
</head>
<body>
    <div id="background-layer"></div>
    
    <!-- Header: Опущен чуть ниже для кнопок TG -->
    <header class="app-header">
        <div class="header-left">
            <div class="city-selector">
                <span id="current-city">Karaganda</span> • <span id="current-temp">-2°C</span> ❄️
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
            </div>
            <h1 class="brand-logo">Aitax</h1>
        </div>
        <button class="menu-btn" onclick="toggleSidebar()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
        </button>
    </header>

    <main id="main-content">
        <!-- Вкладка 1: Афиша и Карта -->
        <section id="tab-events" class="tab-content active">
            <div class="sub-nav">
                <button class="sub-nav-btn active" onclick="switchSubTab('afisha')">Афиша</button>
                <button class="sub-nav-btn" onclick="switchSubTab('map')">Карта</button>
            </div>
            
            <div id="afisha-view" class="sub-view active">
                <div class="promo-slider" id="promo-container">
                    <!-- Карточки добавятся через JS -->
                </div>
            </div>
            
            <div id="map-view" class="sub-view">
                <div id="map"></div>
            </div>
        </section>

        <!-- Вкладка 2: Чат города -->
        <section id="tab-feed" class="tab-content">
            <div class="feed-composer-panel" onclick="openCreatePostModal()">
                <div class="user-avatar-mini"></div>
                <span class="placeholder-text">Что нового?</span>
            </div>
            <div class="feed-container" id="posts-feed">
                <!-- Посты -->
            </div>
        </section>

        <!-- Вкладка 3: ИИ и Такси (Пусто, так как управление через модалку Ai) -->
        <section id="tab-ai" class="tab-content">
            <div class="ai-placeholder">
                <p>Нажмите на синюю кнопку <b>Ai</b> внизу для заказа</p>
            </div>
        </section>

        <!-- Вкладка 4: Кошелек -->
        <section id="tab-wallet" class="tab-content">
            <div class="wallet-card">
                <span class="label">Баланс</span>
                <h2 class="balance-amount">42 500 ₸</h2>
                <div class="wallet-actions">
                    <button class="w-btn"><div class="w-icon">+</div>Пополнить</button>
                    <button class="w-btn"><div class="w-icon">→</div>Перевести</button>
                    <button class="w-btn"><div class="w-icon">∷</div>QR</button>
                </div>
                <p class="wallet-promo">⚡ Пополняйте счет и катайтесь со скидкой!</p>
            </div>
            <h3 class="section-title">История транзакций</h3>
            <div class="empty-state">История пуста</div>
        </section>

        <!-- Вкладка 5: Кабинет водителя -->
        <section id="tab-driver" class="tab-content">
            <div class="driver-tabs-header">
                <button class="d-tab active" onclick="switchDriverTab('city')">Город</button>
                <button class="d-tab" onclick="switchDriverTab('intercity')">Межгород</button>
            </div>
            
            <div id="driver-city" class="driver-content active">
                <h3 class="section-title">Эфир заказов (Город)</h3>
                <div id="city-orders-list">
                    <div class="empty-state">Нет активных заказов в городе</div>
                </div>
            </div>
            
            <div id="driver-intercity" class="driver-content">
                <h3 class="section-title">Эфир заказов (Межгород)</h3>
                <div id="intercity-orders-list">
                    <!-- Сюда будут падать заказы -->
                </div>
            </div>
        </section>
    </main>

    <!-- Dockbar -->
    <nav class="dockbar">
        <button class="dock-item active" onclick="switchTab('events', this)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
        </button>
        <button class="dock-item" onclick="switchTab('feed', this)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
        </button>
        <div class="dock-ai-container">
            <button class="ai-main-btn" onclick="toggleAiModal()">Ai</button>
        </div>
        <button class="dock-item" onclick="switchTab('wallet', this)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="4" width="20" height="16" rx="2"/><line x1="2" y1="10" x2="22" y2="10"/></svg>
        </button>
        <button class="dock-item" onclick="switchTab('driver', this)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18.36 6.64a9 9 0 1 1-12.73 0"/><line x1="12" y1="2" x2="12" y2="12"/></svg>
        </button>
    </nav>

    <!-- Модалка AI и Такси -->
    <div id="ai-modal" class="modal-overlay">
        <div class="modal-sheet ai-sheet">
            <div class="sheet-handle"></div>
            <div class="ai-chat-container" id="ai-chat-box">
                <!-- Диалог с ИИ -->
            </div>
            <div class="ai-input-wrapper">
                <input type="text" id="ai-input" placeholder="AI чат или адрес..." onkeypress="handleAiInput(event)">
                <button class="ai-send-btn" onclick="sendAiMessage()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
                </button>
            </div>
            
            <div class="taxi-options-grid">
                <div class="address-row">
                    <div class="addr-dot from"></div>
                    <div class="addr-text">Мое местоположение</div>
                </div>
                <div class="address-row">
                    <div class="addr-dot to"></div>
                    <input type="text" id="order-to" class="addr-input" placeholder="Укажите точку Б">
                </div>
                
                <div class="extra-options">
                    <div class="opt-box" onclick="openModal('comment-modal')">
                        <span class="opt-label">Комментарий</span>
                        <span class="opt-val" id="comment-display">Указать...</span>
                    </div>
                    <div class="opt-box" onclick="openModal('intercity-modal')">
                        <span class="opt-label">Межгород</span>
                        <span class="opt-val" id="intercity-display">Выбрать...</span>
                    </div>
                </div>

                <div class="tariffs-scroll">
                    <button class="tariff-btn active" data-tariff="Эконом">Эконом</button>
                    <button class="tariff-btn" data-tariff="Комфорт">Комфорт</button>
                    <button class="tariff-btn" data-tariff="Бизнес">Бизнес</button>
                    <button class="tariff-btn lady" data-tariff="Lady">Lady</button>
                </div>

                <button class="order-confirm-btn" onclick="startOrder()">Поехали</button>
            </div>
        </div>
    </div>

    <!-- Модалка Межгород -->
    <div id="intercity-modal" class="modal-overlay">
        <div class="modal-sheet">
            <div class="modal-header">
                <h3>Межгород</h3>
                <button class="close-modal" onclick="closeModal('intercity-modal')">✕</button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label>Откуда</label>
                    <select id="inter-from">
                        <option>Караганда</option>
                        <option>Астана</option>
                        <option>Алматы</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Куда</label>
                    <select id="inter-to">
                        <option>Астана</option>
                        <option>Караганда</option>
                        <option>Алматы</option>
                        <option>Павлодар</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Количество мест</label>
                    <input type="number" id="inter-seats" value="1" min="1" max="8">
                </div>
                <div class="input-group">
                    <label>Цена (₸)</label>
                    <input type="number" id="inter-price" placeholder="Ваша цена">
                </div>
                <div class="input-group">
                    <label>Комментарий</label>
                    <input type="text" id="inter-comment" placeholder="Напр: багаж">
                </div>
                <button class="primary-btn" onclick="saveIntercity()">Подтвердить</button>
            </div>
        </div>
    </div>

    <!-- Модалка Настройки -->
    <div id="settings-modal" class="modal-overlay">
        <div class="modal-sheet">
            <div class="modal-header">
                <h3>Настройки</h3>
                <button class="close-modal" onclick="closeModal('settings-modal')">✕</button>
            </div>
            <div class="settings-list">
                <div class="settings-row" onclick="toggleLanguage()">
                    <span>Язык</span>
                    <span class="val" id="lang-val">Русский</span>
                </div>
                <div class="settings-row"><span>Настройка профиля</span></div>
                <div class="settings-row"><span>История заказов</span></div>
                <div class="settings-row"><span>Способы оплаты</span></div>
                <div class="settings-row"><span>Уведомления</span></div>
                <div class="settings-row"><span>Безопасность</span></div>
                <div class="settings-row"><span>Помощь ИИ</span></div>
            </div>
        </div>
    </div>

    <!-- Модалка Создания Поста -->
    <div id="create-post-modal" class="modal-overlay">
        <div class="modal-sheet">
            <div class="modal-header">
                <h3>Новый пост</h3>
                <button class="close-modal" onclick="closeCreatePost()">✕</button>
            </div>
            <div class="post-body">
                <textarea id="post-text" class="post-textarea" placeholder="Что нового?"></textarea>
                <div id="post-preview-container" class="post-preview hidden"></div>
                <div class="post-attach-row">
                    <label class="attach-btn">
                        <input type="file" id="post-image-input" accept="image/*" hidden>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
                        Фото
                    </label>
                </div>
                <button class="primary-btn" onclick="submitPost()">Опубликовать</button>
            </div>
        </div>
    </div>

    <!-- Sidebar -->
    <div id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <div class="user-profile">
                <div class="user-avatar"></div>
                <div class="user-info">
                    <span class="user-name">Пользователь</span>
                    <span class="user-status">Demo Mode</span>
                </div>
            </div>
        </div>
        <div class="sidebar-menu">
            <div class="menu-item" onclick="openModal('settings-modal')">Настройки</div>
            <div class="menu-item" onclick="logoutDemo()">Выйти</div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="script (3).js"></script>
</body>
</html>